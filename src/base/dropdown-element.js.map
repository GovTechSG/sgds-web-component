{"version":3,"file":"dropdown-element.js","sourceRoot":"","sources":["dropdown-element.ts"],"names":[],"mappings":";AAEA,OAAO,QAAQ,MAAM,2BAA2B,CAAC;AAEjD,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AACpD,OAAO,EAAO,SAAS,EAAE,MAAM,uBAAuB,CAAC;AACvD,OAAO,SAAS,MAAM,oBAAoB,CAAC;AAC3C,OAAO,WAAW,MAAM,gBAAgB,CAAC;AACzC,OAAO,UAAU,MAAM,qBAAqB,CAAC;AAE7C,MAAM,UAAU,GAAG,WAAW,CAAC;AAC/B,MAAM,QAAQ,GAAG,SAAS,CAAC;AAC3B,MAAM,GAAG,GAAG,QAAQ,CAAC;AAIrB;;;;;GAKG;AAEH,MAAM,OAAO,eAAgB,SAAQ,WAAW;IAAhD;QACE,sCAAsC;;QAEtC,gBAAgB;QACN,eAAU,GAAqB,SAAS,EAAE,CAAC;QACrD,gBAAgB;QACN,eAAU,GAAe,IAAI,CAAC;QAExC,0DAA0D;QAChD,mBAAc,GAAW,UAAU,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;QAEtE,+CAA+C;QAErC,WAAM,GAAG,KAAK,CAAC;QAEzB,+EAA+E;QAErE,mBAAc,GAAG,KAAK,CAAC;QAEjC,wEAAwE;QAE9D,SAAI,GAAkB,MAAM,CAAC;QAEvC,iGAAiG;QAEjG,eAAU,GAAG,EAAE,CAAC;QAKhB,gBAAgB;QAEN,gBAAW,GAAsB,EAAE,CAAC;QAE9C,mDAAmD;QAEnD,eAAU,GAAG,KAAK,CAAC;QAEnB,2IAA2I;QAE3I,UAAK,GAAqC,SAAS,CAAC;QAEpD,mCAAmC;QAEnC,aAAQ,GAAG,KAAK,CAAC;IAmHnB,CAAC;IAjHC,iBAAiB;QACf,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAE1B,IAAI,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE,CAAC;YAC5B,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAiB,EAAE,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;QACxG,CAAC;IACH,CAAC;IAED,oBAAoB;QAClB,KAAK,CAAC,oBAAoB,EAAE,CAAC;QAE7B,QAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC,KAAiB,EAAE,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;IAC3G,CAAC;IAED,YAAY;QACV,IAAI,CAAC,UAAU,GAAG,IAAI,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE;YACpD,mKAAmK;YACnK,SAAS,EAAE,QAAQ,EAAE,UAAU;YAC/B,YAAY,EAAE,CAAC,aAAuC,EAAE,EAAE;gBACxD,SAAS;gBACT,IAAI,CAAC,cAAc,GAAG;oBACpB,SAAS,EAAE,cAAc;oBACzB,SAAS,EAAE,CAAC,IAAI,CAAC,MAAM;wBACrB,CAAC,CAAC,IAAI,CAAC,WAAW;wBAClB,CAAC,CAAC;4BACE,GAAG,IAAI,CAAC,WAAW;4BACnB;gCACE,IAAI,EAAE,MAAM;gCACZ,OAAO,EAAE,EAAE,kBAAkB,EAAE,EAAE,EAAE;6BACpC;yBACF;iBACN,CAAC;gBAEF,QAAQ,IAAI,CAAC,IAAI,EAAE,CAAC;oBAClB,KAAK,IAAI;wBACP,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,CAAC;wBAC9E,MAAM;oBACR,KAAK,OAAO;wBACV,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,aAAa,CAAC;wBAC9C,MAAM;oBACR,KAAK,MAAM;wBACT,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,YAAY,CAAC;wBAC7C,MAAM;oBACR,KAAK,MAAM;wBACT,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,cAAc,CAAC;wBACpF,MAAM;oBACR;wBACE,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,SAAS,CAAC;wBAC1C,MAAM;gBACV,CAAC;gBACD,OAAO,SAAS,CAAC,aAAa,EAAE,SAAS,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YACnF,CAAC;SACF,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,GAAG,EAAE;YAC9D,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YACvB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACzB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,GAAG,EAAE;YAC/D,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YACvB,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC/B,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,GAAG,EAAE;YAC9D,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACzB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,GAAG,EAAE;YAChE,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC/B,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;IAClE,CAAC;IAED,4CAA4C;IACrC,QAAQ;QACb,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;IACzB,CAAC;IAED,4CAA4C;IACrC,QAAQ;QACb,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;IACzB,CAAC;IAED,UAAU;QACR,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;IAC3B,CAAC;IAEO,wBAAwB,CAAC,CAAgB;QAC/C,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;YACd,KAAK,UAAU;gBACb,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,IAAI,CAAC,IAAI,CAAC,UAAU;oBAAE,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAC7C,MAAM;YACR,KAAK,QAAQ;gBACX,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,IAAI,CAAC,IAAI,CAAC,UAAU;oBAAE,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAC7C,MAAM;YACR,KAAK,GAAG;gBACN,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC;YACzB;gBACE,MAAM;QACV,CAAC;IACH,CAAC;IAEO,wBAAwB,CAAC,CAAa,EAAE,IAAqB;QACnE,IAAI,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC;YACrC,IAAI,CAAC,QAAQ,EAAE,CAAC;QAClB,CAAC;IACH,CAAC;CACF;AAlJW;IADT,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;+CAChB;AAIf;IADT,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;uDACvB;AAIvB;IADT,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;6CAChB;AAIvC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;mDACX;AAIhB;IADC,KAAK,EAAE;uDACgC;AAG9B;IADT,KAAK,EAAE;oDACsC;AAI9C;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;mDACxB;AAInB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;8CACyB;AAIpD;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;iDAC1B","sourcesContent":["import type { StrictModifiers } from \"@popperjs/core\";\nimport * as Popper from \"@popperjs/core\";\nimport Dropdown from \"bootstrap/js/src/dropdown\";\nimport type { Dropdown as BsDropdown } from \"bootstrap\";\nimport { property, state } from \"lit/decorators.js\";\nimport { Ref, createRef } from \"lit/directives/ref.js\";\nimport mergeDeep from \"../utils/mergeDeep\";\nimport SgdsElement from \"./sgds-element\";\nimport generateId from \"../utils/generateId\";\n\nconst ARROW_DOWN = \"ArrowDown\";\nconst ARROW_UP = \"ArrowUp\";\nconst ESC = \"Escape\";\n\nexport type DropDirection = \"left\" | \"right\" | \"up\" | \"down\";\n\n/**\n * @event sgds-show - Emitted event when show instance is called\n * @event sgds-after-show - Emitted event when dropdown has been made visible to the user and CSS transitions have completed\n * @event sgds-hide - Emitted event when hide instance is called\n * @event sgds-after-hide - Emitted event when dropdown has hidden to the user and CSS transitions have completed\n */\n\nexport class DropdownElement extends SgdsElement {\n  // static styles = SgdsElement.styles;\n\n  /** @internal */\n  protected myDropdown: Ref<HTMLElement> = createRef();\n  /** @internal */\n  protected bsDropdown: BsDropdown = null;\n\n  /** @internal Unique id generated for the dropdown menu */\n  protected dropdownMenuId: string = generateId(\"dropdown-menu\", \"div\");\n\n  /** @internal Controls auto-flipping of menu */\n  @property({ type: Boolean, state: true })\n  protected noFlip = false;\n\n  /** @internal When true, aligns right edge of menu with right edge of button */\n  @property({ type: Boolean, reflect: true, state: true })\n  protected menuAlignRight = false;\n\n  /** @internal The drop position of menu relative to the toggle button */\n  @property({ type: String, reflect: true, state: true })\n  protected drop: DropDirection = \"down\";\n\n  /**  Additional configuration to pass to Popper.js. See https://popper.js.org/ for config opts */\n  @property({ type: Object })\n  popperOpts = {};\n\n  /** @internal */\n  @state()\n  dropdownConfig: Partial<Popper.Options>;\n  /** @internal */\n  @state()\n  protected modifierOpt: StrictModifiers[] = [];\n\n  /** When true, dropdown menu shows on first load */\n  @property({ type: Boolean, reflect: true })\n  menuIsOpen = false;\n\n  /** Controls the close behaviour of dropdown menu. By default menu auto-closes when SgdsDropdownItem or area outside dropdown is clicked */\n  @property({ type: String })\n  close: \"outside\" | \"default\" | \"inside\" = \"default\";\n\n  /** Disables the dropdown toggle */\n  @property({ type: Boolean, reflect: true })\n  disabled = false;\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    if (this.close !== \"inside\") {\n      document.addEventListener(\"click\", (event: MouseEvent) => this._handleClickOutOfElement(event, this));\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    document.removeEventListener(\"click\", (event: MouseEvent) => this._handleClickOutOfElement(event, this));\n  }\n\n  firstUpdated() {\n    this.bsDropdown = new Dropdown(this.myDropdown.value, {\n      // autoClose not working as bootstrap is using attribute data-bs-toggle=\"dropdown\" to configure autoclose. But it doesnt look into this attribute in the shadow dom\n      reference: \"toggle\", // working\n      popperConfig: (defaultConfig?: Partial<Popper.Options>) => {\n        //working\n        this.dropdownConfig = {\n          placement: \"bottom-start\",\n          modifiers: !this.noFlip\n            ? this.modifierOpt\n            : [\n                ...this.modifierOpt,\n                {\n                  name: \"flip\",\n                  options: { fallbackPlacements: [] }\n                }\n              ]\n        };\n\n        switch (this.drop) {\n          case \"up\":\n            this.dropdownConfig.placement = this.menuAlignRight ? \"top-end\" : \"top-start\";\n            break;\n          case \"right\":\n            this.dropdownConfig.placement = \"right-start\";\n            break;\n          case \"left\":\n            this.dropdownConfig.placement = \"left-start\";\n            break;\n          case \"down\":\n            this.dropdownConfig.placement = this.menuAlignRight ? \"bottom-end\" : \"bottom-start\";\n            break;\n          default:\n            this.dropdownConfig.placement = undefined;\n            break;\n        }\n        return mergeDeep(defaultConfig, mergeDeep(this.dropdownConfig, this.popperOpts));\n      }\n    });\n\n    this.myDropdown.value.addEventListener(\"show.bs.dropdown\", () => {\n      this.menuIsOpen = true;\n      this.emit(\"sgds-show\");\n    });\n\n    this.myDropdown.value.addEventListener(\"shown.bs.dropdown\", () => {\n      this.menuIsOpen = true;\n      this.emit(\"sgds-after-show\");\n    });\n\n    this.myDropdown.value.addEventListener(\"hide.bs.dropdown\", () => {\n      this.menuIsOpen = false;\n      this.emit(\"sgds-hide\");\n    });\n\n    this.myDropdown.value.addEventListener(\"hidden.bs.dropdown\", () => {\n      this.menuIsOpen = false;\n      this.emit(\"sgds-after-hide\");\n    });\n\n    this.addEventListener(\"keydown\", this._handleKeyboardMenuEvent);\n  }\n\n  /** When invoked, opens the dropdown menu */\n  public showMenu() {\n    this.bsDropdown.show();\n  }\n\n  /** When invoked, hides the dropdown menu */\n  public hideMenu() {\n    this.bsDropdown.hide();\n  }\n\n  toggleMenu() {\n    this.bsDropdown.toggle();\n  }\n\n  private _handleKeyboardMenuEvent(e: KeyboardEvent) {\n    switch (e.key) {\n      case ARROW_DOWN:\n        e.preventDefault();\n        if (!this.menuIsOpen) return this.showMenu();\n        break;\n      case ARROW_UP:\n        e.preventDefault();\n        if (!this.menuIsOpen) return this.showMenu();\n        break;\n      case ESC:\n        return this.hideMenu();\n      default:\n        break;\n    }\n  }\n\n  private _handleClickOutOfElement(e: MouseEvent, self: DropdownElement) {\n    if (!e.composedPath().includes(self)) {\n      this.hideMenu();\n    }\n  }\n}\n"]}