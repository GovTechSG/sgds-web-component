# Contributing Guide
[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)

Thank you so much for contributing to @govtechsg/sgds-web-component. Please read this guideline before starting your development works. 

## Development 

This project uses Lit 2.0 + SASS + TS and bundled with rollup 

### Folder Structure

Build new components in src folder. Create folder name according to the component you are building.
SCSS files specific to the component should be stored here. Create an entry point (index.ts) file per folder to export the components/classes and its types/interface 

Place common/reusable functions and global stylings in utils folder 

### Filename 
Custom elements must be in kebab case. Prefix the files with sgds-*.ts

## Testing 

Unit test is written in typescript, compiled to javascript by rollup, dumped into test-outdir. The resulting test-outdir/**.test.js files are run by web-test-runner. Configuration wise, rollup has plugins to convert sass files to css, but web-test-runner does not have great support for sass files atm. Hence, this approach was taken. See configurations in rollup.test.config.js and web-test-runner.config.mjs.

All test needs to pass in order for aws amplify deployment build to pass

### Run single test file

To run single test file, run the output javascript test file instead of the typescript file
```npm run test test-outdir/button-element.test.js```

## Storybook 

Write documentation in storybook in MDX format. Include API argstable, import instructions, at least a basic example and custom css properties table (if present)

## Markdown files and README.md

.md files are located in docs folder. These markdown files are used in both Storybook and github's README.
 Do not edit README.md file directly. Instead edit the markdown files in docs folder and run `npm run build:readme`. Note that Gulp-concat will combine the files in alphabetical order - name any new markdown files with this in mind.

## Output React components

- Using custom-elements-manifest/analzyer to obtain metadata info of the Lit components. Read more [here](https://custom-elements-manifest.open-wc.org/analyzer/getting-started/#how-it-works) 

- Document your component class with the relevant [jsdoc tags](https://api-viewer.open-wc.org/docs/guide/writing-jsdoc/). See examples in Button, Masthead, Sidenav folder. 

- ```npm run build:react``` runs the cem analyer which reads custom-elements-manifest.config.mjs file. This manifest file tells cem analyzer what files to process and generate the output file custom-elements.json. Script file in scripts/makeReact.mjs reads custom-elements.json file and outputs the react components of all components automatically using @lit-labs/react. 

- `src/react` and `custom-elements.json` are untracked and will be generated by CI github actions during build step ```npm run build:lib```

- During rollup build step, the ```src/react``` folder is read and output in ```lib/react``` and  the rest of the Lit components in ```lib```

- React users should import as such : 
named exports when importing from whole library entry point
```import {SgdsMasthead} from 'clk-web-components/react';``` 
or
default exports when importing from specific component entry points
```import SgdsMasthead from 'clk-web-components/react/masthead'```; 
```import SgdsSidenavItem from 'clk-web-components/react/sidenav-item'```;
```import Sidenav from 'clk-web-components/react/sidenav'```;

- All steps in this section are included in ```npm run build:lib``` 

## Publishing (for admin only)
Library publication is performed in workflow by github actions. When ready for publishing, perform the following steps

##### Bump version 
1) run ```npm version <major|minor|path> ```
    or for alpha releases
    ``` npm version <version-name> ```
    **version number should observe SEMVER
    **this step will auto-generate a git tag on your local
2) ```git push ``` the changes

##### Generate Changelog 
3) run ```cz changelog``` to update CHANGELOG.md file (ensure that you have set up [cz-cli](https://github.com/commitizen/cz-cli) globally)
**`cz changelog` updates based on your local git tags
4) Push the changes 
    
##### Push git tag
4) run `git tag` to check the newly generated git tag on local
5) ```npm push origin <newly-created-tag> ```
** this triggers gh action workflow to publish the library to npm 
##### Create a release
6) Manually create a release on github 
